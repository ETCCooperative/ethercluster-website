(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{367:function(e,t,a){"use strict";a.r(t);var s=a(42),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"getting-started"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getting-started"}},[e._v("#")]),e._v(" Getting Started")]),e._v(" "),a("p",[e._v("This guide will help you build your own Ethereum Classic API service using Ethercluster. This guide currently features Ethercluster deployment on Google Cloud Platform.")]),e._v(" "),a("h2",{attrs:{id:"step-01-setup-google-cloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-01-setup-google-cloud"}},[e._v("#")]),e._v(" Step 01 - Setup Google Cloud")]),e._v(" "),a("ul",[a("li",[e._v("Signup for a "),a("a",{attrs:{href:"https://cloud.google.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Cloud"),a("OutboundLink")],1),e._v(" account and "),a("a",{attrs:{href:"https://console.cloud.google.com/projectcreate",target:"_blank",rel:"noopener noreferrer"}},[e._v("create a new project"),a("OutboundLink")],1),e._v(". You can conveniently name your project, "),a("code",[e._v("ethercluster")]),e._v(".")])]),e._v(" "),a("img",{attrs:{width:"540",alt:"gcp_project",src:"https://user-images.githubusercontent.com/10556209/96285459-9c85ce00-0fa4-11eb-9407-277b6ee700ca.png"}}),e._v(" "),a("ul",[a("li",[a("p",[e._v("Setup "),a("a",{attrs:{href:"https://cloud.google.com/billing/docs/how-to/modify-project",target:"_blank",rel:"noopener noreferrer"}},[e._v("billing"),a("OutboundLink")],1),e._v(" if you're going to pursue making your Ethercluster.")])]),e._v(" "),a("li",[a("p",[e._v("Enable "),a("strong",[e._v("Compute Engine API")]),e._v(", "),a("strong",[e._v("Cloud Shell API")]),e._v(", and "),a("strong",[e._v("Kubernetes Engine API")]),e._v(" which can be found in the "),a("a",{attrs:{href:"https://console.cloud.google.com/apis?_ga=2.172155431.56694028.1602866660-1600774775.1602866660",target:"_blank",rel:"noopener noreferrer"}},[e._v("Marketplace"),a("OutboundLink")],1),e._v(". For example:")])])]),e._v(" "),a("img",{attrs:{width:"497",alt:"gcp_enable_api",src:"https://user-images.githubusercontent.com/10556209/96285814-0e5e1780-0fa5-11eb-95ff-a3a3d571bf0a.png"}}),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://cloud.google.com/docs/authentication/getting-started",target:"_blank",rel:"noopener noreferrer"}},[e._v("Setup Credentials"),a("OutboundLink")],1),e._v(" which will generate a JSON file for you to download. This will be used to easily authenticate into Google Cloud from your local terminal.")])]),e._v(" "),a("h2",{attrs:{id:"step-02-install-terraform"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-02-install-terraform"}},[e._v("#")]),e._v(" Step 02 - Install Terraform")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.terraform.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Terraform"),a("OutboundLink")],1),e._v(" is infra-as-code to allow you to provision your cloud infrastructure in a way that's clear and easy to roll-back and version control.")]),e._v(" "),a("p",[e._v("This allows any changes you make to your cloud architecture to be reflected in code and saved, so that any new changes you add can be tracked and debugged.")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.terraform.io/downloads.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Download, unpack, and install Terraform"),a("OutboundLink")],1),e._v(" via release binary for your operating system https://www.terraform.io/downloads.html.")])]),e._v(" "),a("p",[e._v("Downloading binary on Linux:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://releases.hashicorp.com/terraform/0.13.4/terraform_0.13.4_linux_amd64.zip\n")])])]),a("p",[e._v("Unpack files:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("unzip")]),e._v(" terraform_0.13.4_linux_amd64.zip\n")])])]),a("p",[e._v("At this point the executable "),a("code",[e._v("terraform")]),e._v(" binary can be run. However, you may want to move it in a more appropriate location and add to your PATH.")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" terraform /bin/\n")])])]),a("p",[e._v("or move anywhere else and export to PATH")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" terraform /"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$PATH")]),e._v(":/"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$HOME")]),e._v('/terraform"')]),e._v("\n")])])]),a("p",[e._v("Run terraform from a terminal")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("terraform\n")])])]),a("h2",{attrs:{id:"step-03-create-a-terraform-configuration-for-gke"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-03-create-a-terraform-configuration-for-gke"}},[e._v("#")]),e._v(" Step 03 - Create a Terraform configuration for GKE")]),e._v(" "),a("p",[e._v("Create directory for your Terraform project and change directory into it:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" Ethercloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" Ethercloud\n")])])]),a("p",[e._v("Initialize a new Terraform project:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("terraform init\n")])])]),a("p",[e._v("Terraform will return the following since there's no existing Terraform config files.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Terraform initialized in an empty directory!\n\nThe directory has no Terraform configuration files. You may begin working\nwith Terraform immediately by creating Terraform configuration files.\n")])])]),a("p",[e._v("Now, create a new Terraform configuration file:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" ethercloud.tf\n")])])]),a("p",[e._v("Using your preferred editor, we'll have to specify our Ethercluster infrastructure in "),a("code",[e._v("ethercloud.tf")]),e._v(" like so:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('provider "google" {\n    project = "ethercluster"\n    region = "us-central1"       \n    zone = "us-central1-c"\n}\n\nresource "google_container_cluster" "primary" {\n    name = "ether-cluster"\n    \n    remove_default_node_pool = true\n    initial_node_count = 1\n\n    master_auth {\n        username = ""\n        password = ""\n    }\n}\n\nresource "google_container_node_pool" "primary_preemptible_nodes" {\n    name = "my-node-pool"\n    cluster = "${google_container_cluster.primary.name}"\n    node_count = 3\n    \n    node_config {\n        preemptible = true\n        machine_type = "n1-standard-1"\n\n        metadata = {\n            disable-legacy-endpoints = "true"\n        }\n\n        oauth_scopes = [\n            "https://www.googleapis.com/auth/logging.write",\n            "https://www.googleapis.com/auth/monitoring",\n        ]\n    }\n}\n\noutput "client_certificate" {\n    value = "${google_container_cluster.primary.master_auth.0.client_certificate}"\n}\n\noutput "client_key" {\n    value = "${google_container_cluster.primary.master_auth.0.client_key}"\n}\n\noutput "cluster_ca_certificate" {\n    value = "${google_container_cluster.primary.master_auth.0.cluster_ca_certificate}"\n}\n\nresource "google_compute_address" "ip_address" {\n    name = "ethercluster-address"\n}\n')])])]),a("h2",{attrs:{id:"understanding-our-terraform-configuration-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#understanding-our-terraform-configuration-file"}},[e._v("#")]),e._v(" Understanding our Terraform configuration file")]),e._v(" "),a("h4",{attrs:{id:"provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#provider"}},[e._v("#")]),e._v(" Provider")]),e._v(" "),a("div",{staticClass:"language-tf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('provider "google" {\n    project = "ethercloud"\n    region = "us-central1"\n    zone = "us-central1-c"\n}\n')])])]),a("p",[e._v("What we did here was specify provider as "),a("code",[e._v("google")]),e._v(", gave it a project name "),a("code",[e._v("ethercloud")]),e._v(", and then added the region "),a("code",[e._v("us-central-1")]),e._v(" and the zone "),a("code",[e._v("us-central1-c")]),e._v(". You don't have to use the same names and regions, but this will be what I use for the purpose of this guide.")]),e._v(" "),a("h3",{attrs:{id:"gke"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gke"}},[e._v("#")]),e._v(" GKE")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('resource "google_container_cluster" "primary" {\n    name = "ethercluster"\n\n    remove_default_node_pool = true\n    initial_node_count = 1\n\n    master_auth {\n        username = ""\n        password = ""\n    }\n}\n')])])]),a("p",[e._v("This specifies that we want a GKE cluster we will call "),a("code",[e._v("primary")]),e._v(". We also specify the cluster name as "),a("code",[e._v("ethercluster")]),e._v(" We add an initial node count of "),a("code",[e._v("1")]),e._v(", but we can't specify our own Kubernetes node pool first, so we use the initial node count and then we delete it. We have our "),a("code",[e._v("master_auth")]),e._v(" set to empty because we don't want to use any custom auth.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('resource "google_container_node_pool" "primary_preemptible_nodes" {\n    name = "my-node-pool"\n    cluster = "${google_container_cluster.primary.name}"\n    node_count = 3\n\n    node_config {\n        preemptible = true\n        machine_type = "n1-standard-1"\n\n        metadata = {\n            disable-legacy-endpoints = "true"\n        }\n\n        oauth_scopes = [\n            "https://www.googleapis.com/auth/logging.write",\n            "https://www.googleapis.com/auth/monitoring",\n        ]\n    }\n}\n')])])]),a("p",[e._v("Here we are basically specifying the node pool with 3 nodes. Three nodes means three Google Compute Engine instances where we will be hosting out Kubernetes cluster. We also specify the type of instance to be "),a("code",[e._v("n1-standard-1")]),e._v(".")]),e._v(" "),a("p",[e._v("For more information on this setup, checkout the guide from Terraform "),a("a",{attrs:{href:"https://www.terraform.io/docs/providers/google/r/container_cluster.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Moving forward, we want to add the Cluster certificate and a static IP address in case you chose to expose your RPC endpoint publicly over SSL. It'll be easier to assign it to a static IP address you created on GKE so it doesn't change addresses every time you modify it.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('output "client_certificate" {\n    value = "${google_container_cluster.primary.master_auth.0.client_certificate}"\n}\n\noutput "client_key" {\n    value = "${google_container_cluster.primary.master_auth.0.client_key}"\n}\n\noutput "cluster_ca_certificate" {\n    value = "${google_container_cluster.primary.master_auth.0.cluster_ca_certificate}"\n}\n\nresource "google_compute_address" "ip_address" {\n    name = "ethercluster-address"\n}\n')])])]),a("p",[e._v("Here, we basically specify the client key and certificate, as well as cluster certificate and ip_address. We will call this address "),a("code",[e._v("ethercluster-address")]),e._v(".")]),e._v(" "),a("p",[e._v("Great, we finally have the entire code we need to get started. Let's start terraforming!")]),e._v(" "),a("h2",{attrs:{id:"step-04-terraform-plan-and-apply-infrastructure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-04-terraform-plan-and-apply-infrastructure"}},[e._v("#")]),e._v(" Step 04 - Terraform "),a("code",[e._v("Plan")]),e._v(" and "),a("code",[e._v("Apply")]),e._v(" infrastructure")]),e._v(" "),a("p",[e._v("Now that your infrastructure is defined in your terraform configuration file, it's time to "),a("code",[e._v("terraform plan")]),e._v(" & "),a("code",[e._v("terraform apply")]),e._v(".")]),e._v(" "),a("p",[e._v("Terraform plan allows you to see what changes Terraform will do to your file without making the changes. It also is helpful for catching bugs.")]),e._v(" "),a("p",[e._v("Run "),a("code",[e._v("terraform plan")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("terraform plan\n")])])]),a("p",[e._v("Terraform will analyse your code and return an output like the following:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Refreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but will not be\npersisted to local or remote state storage.\n\n\n------------------------------------------------------------------------\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # google_compute_address.ip_address will be created\n  + resource "google_compute_address" "ip_address" {\n      + address_type       = "EXTERNAL"\n      + name               = "ethercluster-address"\n      *\n    }\n\n  # google_container_cluster.primary will be created\n  + resource "google_container_cluster" "primary" {\n      + name                        = "ether-cluster"\n      + network                     = "default"\n      *\n    }\n\n  # google_container_node_pool.primary_preemptible_nodes will be created\n  + resource "google_container_node_pool" "primary_preemptible_nodes" {\n      + cluster             = "ether-cluster"\n      + id                  = (known after apply)\n      *\n      + management {\n          * \n        }\n\n      + node_config {\n            *\n        }\n    }\n\nPlan: 3 to add, 0 to change, 0 to destroy.\n\n------------------------------------------------------------------------\n')])])]),a("p",[e._v("Note, this isn't the exact output, it'll have a lot more data in it with keys, but the values will say "),a("code",[e._v("(known after apply)")]),e._v(". This tells us that Terraform won't have the exact values for the configuration of our cloud for most of the keys until after we actually create our architecture on Google Cloud.")]),e._v(" "),a("p",[e._v("To apply the configuration on Google Cloud, simply run "),a("code",[e._v("terraform apply")]),e._v(".")]),e._v(" "),a("p",[e._v("Run Terraform apply:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("terraform apply\n")])])]),a("p",[e._v("Now, since you already have your project json file from Google Cloud for authing added to your PATH in previous sections, Terraform can use it to deploy your cloud architecture for you. It'll go through the same output you saw in plan but with an execution plan and then start creating your instances. It'll take a little time to create, so go have a coffee break while you wait.")]),e._v(" "),a("p",[e._v("The output will look something like the following.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/10556209/96288555-36e81080-0fa9-11eb-8afb-0ff68611cd23.gif",alt:"terraform-apply"}})]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("An execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n*\n*\n*\nApply complete! Resources: 3 added, 0 changed, 0 destroyed.\n")])])]),a("p",[e._v("Terraform has just created your infrastructure architecture on Google Cloud. Now it's time to SSH into Google Cloud Shell.")]),e._v(" "),a("h2",{attrs:{id:"step-05-final-cluster-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-05-final-cluster-setup"}},[e._v("#")]),e._v(" Step 05 - Final cluster setup")]),e._v(" "),a("p",[e._v("Now, at this point we have our Ethercluster node infrastructure deployed which is a fully functioning kubernetes cluster on Google Cloud. Running a node requires storage, the protocol providing client, and our desired networking for access the API.")]),e._v(" "),a("h3",{attrs:{id:"namespace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#namespace"}},[e._v("#")]),e._v(" Namespace")]),e._v(" "),a("p",[e._v("Namespaces in Kubernetes allow us to assign a name for specific projects we are working on inside Kubernetes. It's useful if you want to organize your cluster between "),a("code",[e._v("dev")]),e._v(" and "),a("code",[e._v("prod")]),e._v(" namespaces for example.")]),e._v(" "),a("p",[e._v("Here, we will just be using it for "),a("code",[e._v("ethercluster")]),e._v(" to make it easier to see everything.")]),e._v(" "),a("p",[e._v("To create a namespace, I'll be writing up a YAMl config file for Kubernetes.")]),e._v(" "),a("p",[e._v("Each Kubernetes manifest file has three things:")]),e._v(" "),a("p",[e._v("apiVersion (to specify which API to use)\nkind (to determine what Kubernetes component the file is)\nmetadata (extra information about the manifest)")]),e._v(" "),a("p",[e._v("We also have a "),a("code",[e._v("spec")]),e._v(" section to specify how we want the manifest behaves, which we will see when we build our cluster.")]),e._v(" "),a("p",[e._v("Picking up from where we left off in Google Cloud Shell page, let's see if "),a("code",[e._v("kubectl")]),e._v(" is running. "),a("code",[e._v("kubectl")]),e._v(" is a command line application that uses the Kubernetes API to interact with your cluster.")]),e._v(" "),a("p",[e._v("Connect to cluster from inside Google Cloud Shell:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("gcloud container clusters get-credentials ethercloud --zone us-central1-c --project ethercloud\n")])])]),a("p",[e._v("Check if "),a("code",[e._v("kubectl")]),e._v(" is working:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl\n")])])]),a("p",[e._v("The output would be similar to:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('The output should look something like this:\n\nkubectl controls the Kubernetes cluster manager.\n\nFind more information at: https://kubernetes.io/docs/reference/kubectl/overview/\n\n*\n*\n*\n\nUsage:\n  kubectl [flags] [options]\n\nUse "kubectl <command> --help" for more information about a given command.\nUse "kubectl options" for a list of global command-line options (applies to all commands).\n')])])]),a("p",[e._v("Now, let's define namespace in the Namespace manifect file. You can use "),a("code",[e._v("vim")]),e._v(" or your preferred editor:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" ethercluster-namespace.yml\n")])])]),a("p",[e._v("Add the following:")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster \n")])])]),a("p",[e._v("This specifies that our manifest is "),a("code",[e._v("kind")]),e._v(" of "),a("code",[e._v("Namespace")]),e._v(", with a name of "),a("code",[e._v("ethercluster")]),e._v(".")]),e._v(" "),a("p",[e._v("Now that there is a manifest for Namespace, it has to be applied like so:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f ethercluster-namespace.yml\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("namespace/ethercluster created\n")])])]),a("h3",{attrs:{id:"volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[e._v("#")]),e._v(" Volume")]),e._v(" "),a("p",[e._v("We will need to specify a "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("StorageClass"),a("OutboundLink")],1),e._v(" for our Deployment volume. Here, we will use SSD since it's best for syncing clients.")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" classic-storage-class.yml\n")])])]),a("p",[e._v("Add the following:")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" StorageClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" storage.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("ssd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("provisioner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" kubernetes.io/gce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("pd\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" pd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("ssd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("zones")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" us"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("central1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("c\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("reclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Retain\n")])])]),a("p",[e._v("Notice how we specified the provisioner to be "),a("code",[e._v("gce-pd")]),e._v(". It's to specify the Cloud Provider type of disk we want. We then specify it to be a persistent disk SSD "),a("code",[e._v("pd-ssd")]),e._v(" and the zone is "),a("code",[e._v("us-central1-c")]),e._v(" which is the same one we specified in Terraform, which is where our GKE cluster was created.")]),e._v(" "),a("p",[e._v("Let's create the StorageClass via:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f classic-storage-class.yml\n")])])]),a("p",[e._v("This will create the StorageClass in Google Cloud which we will use when doing a Deployment later.")]),e._v(" "),a("h3",{attrs:{id:"service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[e._v("#")]),e._v(" Service")]),e._v(" "),a("p",[e._v("In Service, we will need to specify the ports we are interested in obtaining from our node. For the purpose of a public RPC endpoint, we will need port 8545 which is the default RPC port. If you need something more custom, like WebSockets, then port 8546 is the one you want. Here, we will only go over 8545. We add 8080 for default and 443 for SSL.")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" classic-service.yml\n")])])]),a("p",[e._v("Add the following:")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cloud.google.com/app-protocols")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{"my-https-port":"HTTPS","my-http-port":"HTTP"}\'')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" default\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" rpc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("endpoint\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" https\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" LoadBalancer\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("sessionAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ClientIP\n")])])]),a("p",[e._v("If you notice, we specify the "),a("code",[e._v("kind")]),e._v(" to be Service here. We call the service "),a("code",[e._v("classic")]),e._v(" which will allow it to auto-discover the deployment after with the same name.")]),e._v(" "),a("p",[e._v("Notice how we have "),a("code",[e._v("port")]),e._v(" and "),a("code",[e._v("targetPort")]),e._v(" specified. It tells the Service we want to this Service's port 8545 to route to the container's port 8545.")]),e._v(" "),a("p",[e._v("We specify the type to be "),a("code",[e._v("LoadBalancer")]),e._v(" to expose it and allow for selecting between the different nodes we will create with Parity. We also add a sessionAffinity so that if you connect to a node assigned by the load balancer, the next time you connect to it, load balancer will reconnect you to the same node.")]),e._v(" "),a("p",[e._v("Create the service:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f classic-service.yml\n")])])]),a("p",[e._v("Now, get all components of your cluster:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get all -n ethercluster\n")])])]),a("p",[e._v("Example output:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE\nservice/classic             LoadBalancer   10.00.00.00   <pending>      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m\n")])])]),a("p",[e._v("The external-ip is "),a("code",[e._v("<pending>")]),e._v(" because Kubernetes is creating an endpoint to expose which may take a few minutes. While this is running we can move onto deploying our blockchain API service.")]),e._v(" "),a("h3",{attrs:{id:"deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[e._v("#")]),e._v(" Deployment")]),e._v(" "),a("p",[e._v("For the rest of this exercise we'll be going over the code found in this "),a("a",{attrs:{href:"https://github.com/ethereum-classic-cooperative/ethercluster",target:"_blank",rel:"noopener noreferrer"}},[e._v("repository"),a("OutboundLink")],1),e._v(" which contains example manifest files. Before running our deployment and running a node we need to figure out what arguments we need for our Docker container image.")]),e._v(" "),a("p",[e._v("We will use "),a("a",{attrs:{href:"https://hub.docker.com/r/hyperledger/besu/tags",target:"_blank",rel:"noopener noreferrer"}},[e._v("Hypereledger Besu"),a("OutboundLink")],1),e._v(" has our protocol providing client. Hyperledger Besu is an enterprise Ethereum client that can be used for Ethereum, Ethereum Classic, and related test networks.")]),e._v(" "),a("p",[e._v("If you're familiar with Docker, running a Besu docker container could be done with the following:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v(":8545 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("13001")]),e._v(":30303 hyperledger/besu:latest --rpc-http-enabled --network"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("CLASSIC\n")])])]),a("p",[e._v("If you go to "),a("code",[e._v("deployments/classic/classic-besu-stateful-set.yml")]),e._v(", you'll see that the file has the "),a("code",[e._v("kind")]),e._v(" value of "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/",target:"_blank",rel:"noopener noreferrer"}},[e._v("StatefulSet"),a("OutboundLink")],1),e._v(". This is important since it specifies we want a stateful application that guarantees ordering and uniqueness across any rescheduling. Imagine we didn't use a statefulset here. If we deploy our container to Kubernetes, Besu begins syncing the chain from the beginning. Kubernetes can then choose to restart Pods at intervals to ensure updates. What happens in this situation is that the restart will also cause Besu to resync from the beginning, which isn't what we desire. It's why StatefulSet is the desired Deployment here.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("apiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: classic\n  namespace: ethercluster\n  labels:\n    app: classic\n")])])]),a("p",[e._v("This is the beginning of our StatefulSet deployment file. It specifies the correct namespace for Ethercluster, names our Deployment "),a("code",[e._v("classic")]),e._v(" in order to be able to identify what network it is, and points the "),a("code",[e._v("kind")]),e._v(" to StatefulSet.")]),e._v(" "),a("p",[e._v("This isn't the only contents of the file, we will go on and define the "),a("code",[e._v("specs")]),e._v(".")]),e._v(" "),a("p",[e._v("In the specs, you'll notice we have the "),a("code",[e._v("replicas")]),e._v(" to be 3. This means we will be running 3 Parity nodes, which we will LoadBalance. In containers section, we specify the image "),a("code",[e._v("besu")]),e._v(" from Besu's Dockerhub endpoint.")]),e._v(" "),a("p",[e._v("We pass in the values to that containers such as "),a("code",[e._v("chain=classic")]),e._v(". This specifies that we want the Ethereum Classic chain to be our default network to run. This is how Kubernetes can specify the arguments for the container like Docker does in the previous example.")]),e._v(" "),a("p",[e._v("We also specify we want the ports 8545 since we want to expose the RPC. We have some readinessProbe and livenessProbe in order to do health checks on the Probe. It happens by doing an HTTP GET request on port 8545 of the container on the endpoint "),a("code",[e._v("/api/health")]),e._v(", which checks if the Parity node is fully synced or not. If it's not synced up yet, it returns a 503, otherwise it will return a 200, thus passing the health check.")]),e._v(" "),a("p",[e._v("We also specify a "),a("code",[e._v("volumeClaimTemplates")]),e._v(" for this Deployment of 50 GB, which is what will be needed to run a full ETC node. If you want to instead run an ETH node, you'll need to adjust the value appropriately (300 GB to stay on the safe side).")]),e._v(" "),a("p",[e._v("Now, we will instantiate the deployment:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f deployments/classic/classic-besu-stateful-set.yml\n")])])]),a("p",[e._v("See the deployment in action:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get all -n ethercluster\n")])])]),a("p",[e._v("Example output:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                     READY   STATUS    RESTARTS   AGE\npod/classic-0                            2/2     Running   0          1m\npod/classic-1                            2/2     Running   0          1m\npod/classic-2                            2/2     Running   0          1m\n\nNAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE\nservice/classic             LoadBalancer   10.00.00.00     109.01.01.01      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m\n\nNAME                       READY   AGE\nstatefulset.apps/classic   3/3     1m\n")])])]),a("p",[e._v("Note that the age shown above might not be exact to what you get since it's still creating each Pod 1 by 1. Why do we have three pods? It's because we specified our replica to be 3 in our deployment file.")]),e._v(" "),a("p",[e._v("Each pod is created by the Statefulset, where it's mounted to a volume from "),a("code",[e._v("classic-ssd")]),e._v(" that we instantiated before, and then each image of the containers are pulled and instantiated, and begin running, before the next pod is created.")]),e._v(" "),a("p",[e._v("Inspect a pod individually:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl describe pod classic-0 -n ethercluster\n")])])]),a("p",[e._v("View logs:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl logs classic-0 besu -n ethercluster\n")])])]),a("p",[e._v("Woohoo! Now you have a fully functioning Ethereum Classic node with built on a kubernetes cluster.")]),e._v(" "),a("h3",{attrs:{id:"confirm-node-is-running"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#confirm-node-is-running"}},[e._v("#")]),e._v(" Confirm node is running")]),e._v(" "),a("p",[e._v("Use "),a("a",{attrs:{href:"https://curl.haxx.se/",target:"_blank",rel:"noopener noreferrer"}},[e._v("cURL"),a("OutboundLink")],1),e._v(" to call "),a("a",{attrs:{href:"https://besu.hyperledger.org/en/stable/Reference/API-Methods/",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON-RPC API methods"),a("OutboundLink")],1),e._v("to confirm the node is running.")]),e._v(" "),a("p",[a("em",[e._v("replace "),a("code",[e._v("IP")]),e._v(" with your "),a("code",[e._v("External IP")]),e._v("  from "),a("code",[e._v("kubectl get services classic -n ethercluster")])])]),e._v(" "),a("p",[a("code",[e._v("eth_chainId")]),e._v(" returns the chain ID of the network:")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[e._v("curl -X POST --data '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"jsonrpc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"method"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eth_chainId"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"params"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("' localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n")])])]),a("p",[a("code",[e._v("eth_syncing")]),e._v(" returns the starting, current, and highest block.")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[e._v("curl -X POST --data '"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"jsonrpc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"method"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"eth_syncing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"params"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("' localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n")])])]),a("p",[e._v("After connecting to mainnet "),a("code",[e._v("eth_syncing")]),e._v(" will return something similar to:")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"jsonrpc"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"id"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"result"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"startingBlock"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"currentBlock"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x2d0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"highestBlock"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x66c0"')]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("h2",{attrs:{id:"scaling-pods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaling-pods"}},[e._v("#")]),e._v(" Scaling Pods")]),e._v(" "),a("p",[e._v("Depending on your network traffic you may need to scale you may need to scale your cluster up or down in Kubernetes with one command:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubernetes scale statefulset classic -n ethercluster --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v("\n")])])]),a("p",[e._v("This will increase replicas to 4 or decrease replicas to however many you desire.")]),e._v(" "),a("p",[e._v("See it being created:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubernetes get all -n ethercluster\n")])])]),a("p",[e._v("Example output:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                     READY   STATUS    RESTARTS   AGE\npod/classic-0                            2/2     Running   0          10m\npod/classic-1                            2/2     Running   0          10m\npod/classic-2                            2/2     Running   0          10m\npod/classic-3                            2/2     Running   0          1m\n\nNAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE\nservice/classic             LoadBalancer   10.00.00.00     109.01.01.01      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   10m\n\nNAME                       READY   AGE\nstatefulset.apps/classic   3/3     10m\n")])])]),a("p",[e._v("Notice you now have a "),a("code",[e._v("classic-3")]),e._v(" pod being created and beginning to sync. You can do the same thing to scale it back to 3 by changing the previous command from 4 replicas to 3. Also, GKE does offer auto-scaling for you if needed, but that'll affect your billing if you don't monitor it consistently.")]),e._v(" "),a("p",[e._v("In the next section, we will go over securing your endpoint with SSL when using it publicly. It's not really needed if you want to use RPC only internally within your own infrastructure.")]),e._v(" "),a("h2",{attrs:{id:"ssl-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl-configuration"}},[e._v("#")]),e._v(" SSL Configuration")]),e._v(" "),a("p",[e._v("To setup SSL configuration you need:")]),e._v(" "),a("ul",[a("li",[e._v("a domain name")]),e._v(" "),a("li",[e._v("SSL certificate for the domain name")])]),e._v(" "),a("p",[a("code",[e._v("Ethercluster.com")]),e._v(" uses Namecheap and Namecheap has a guide on registering an SSL for you which will provide an:")]),e._v(" "),a("ul",[a("li",[e._v("SSL Key "),a("code",[e._v(".key")])]),e._v(" "),a("li",[e._v("SSL Certificate "),a("code",[e._v(".crt")])])]),e._v(" "),a("p",[a("strong",[e._v("NOTE")]),e._v(" Setting up SSL for your Ethercluster is optional, but useful to expose your RPC publicly.")]),e._v(" "),a("h3",{attrs:{id:"secrets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secrets"}},[e._v("#")]),e._v(" Secrets")]),e._v(" "),a("p",[e._v("Now that we have our "),a("code",[e._v("domain-com.key")]),e._v(" and "),a("code",[e._v("domain-com.crt")]),e._v(", we can create a Kubernetes secret for them so we can securely store it.")]),e._v(" "),a("p",[e._v("If we have both files in a directory called "),a("code",[e._v("config")]),e._v(", then we can run the following command to instantiate them:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl tls tls-classic --key ./config/domain-com.key --cert ./config/domain-com.crt --namespace ethercluster \n")])])]),a("h3",{attrs:{id:"ingress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ingress"}},[e._v("#")]),e._v(" Ingress")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ingress"),a("OutboundLink")],1),e._v(" allows us to route to different services to the outside via HTTP and HTTPS, as well as allow us to terminate TCP/SSL.")]),e._v(" "),a("p",[e._v("We will need to create the ingress manifest file then instantiate it. After that, we need to configure the Health Checks in Google Cloud.")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" ingress.yml\n")])])]),a("p",[e._v("And input the following contents in ingress.yml:")]),e._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" extensions/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Ingress\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ingress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("ethercluster\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("annotations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kubernetes.io/ingress.global-static-ip-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ethercluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("address\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kubernetes.io/ingress.allow-http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kubernetes.io/ingress.class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"gce"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" www.domain.com\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" tls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("classic\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" www.domain.com\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" classic\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("servicePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8545")]),e._v("\n")])])]),a("p",[e._v("This specifies that we're creating an ingress that points to "),a("code",[e._v("ethercluster-address")]),e._v(" (the static IP created in Terraform). It also assigns the host to the domains.com we added and provides")]),e._v(" "),a("p",[e._v("It also assigns the host to the domain.com we added and provides the secretName as "),a("code",[e._v("tls-classic")]),e._v(" as we created before. It wires to the backend to the serviceName "),a("code",[e._v("classic")]),e._v(" at port 8545.")]),e._v(" "),a("p",[e._v("Instantiate the ingress:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f ingress.yml\n")])])]),a("p",[e._v("Monitor progression:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl describe ingress ingress-ethercluster -n ethercluster\n")])])]),a("p",[e._v("While you monitor it, you need to head over to Google Cloud to set up the Health Checks. Reason is, it won't be exposed publicly if the health checks aren't passed on Google Cloud, and they're not yet sure how to check the health status of Parity.")]),e._v(" "),a("p",[e._v("We do that by going over to Google Cloud, and then to Kubernetes Engine section on the left, and then click on Services as shown below:")]),e._v(" "),a("img",{attrs:{width:"775",alt:"ingress",src:"https://user-images.githubusercontent.com/10556209/97757447-b954f200-1aca-11eb-9a22-393b4ab3dd71.png"}}),e._v(" "),a("p",[e._v("We click on the Ingress we created earlier here, and then try to determine the port number for your classic service. It's the port number assigned by Kubernetes. You can find it by running the following:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" classic -n ethercluster\n")])])]),a("p",[e._v("It'll return what we saw earlier:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE\nservice/classic             LoadBalancer   10.00.00.00   <pending>      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m\n")])])]),a("p",[e._v("If you notice under "),a("code",[e._v("PORT(S)")]),e._v(", you'll see the port "),a("code",[e._v("8545:30002")]),e._v(". The 30002 is the one assigned by Kubernetes for the abstracted 8545. That's the port you'll need to look for under the Ingress section, as shown below: list-ingress")]),e._v(" "),a("p",[e._v("Click on the appropriate one, which will lead you to its page.")]),e._v(" "),a("p",[e._v("Scroll down until you find the health check section. It has a link under it that you must click as well.")]),e._v(" "),a("p",[e._v("Now, you're taken to the Health Check page.")]),e._v(" "),a("p",[e._v("It checks Parity's 8545 port at actual port 30002. But it does the health check on this endpoint "),a("code",[e._v("/")]),e._v(" Parity health checks happen at "),a("code",[e._v("/api/health")]),e._v(".")]),e._v(" "),a("p",[e._v("Configure it accordingly as shown below, then save it.")]),e._v(" "),a("img",{attrs:{width:"478",alt:"health_check",src:"https://user-images.githubusercontent.com/10556209/97757625-1e104c80-1acb-11eb-9af3-926dd9554312.png"}}),e._v(" "),a("p",[e._v("Now, wait about 10-15 minutes for the health checks to pass. You should be able to now use your RPC endpoint over SSL.")]),e._v(" "),a("p",[e._v("If you have any issues, you can always use "),a("code",[e._v("kubectl describe")]),e._v(" to debug your ingress.")]),e._v(" "),a("p",[e._v("I hope you enjoyed this guide and the cool tools given to us by the Cloud, Kubernetes and Terraform.")])])}),[],!1,null,null,null);t.default=n.exports}}]);