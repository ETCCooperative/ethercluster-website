<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Build your first Ethercluster | Ethercluster</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Build your first Ethercluster | Ethercluster"><meta data-react-helmet="true" name="description" content="This guide will help you build your own Ethereum Classic API service using Ethercluster. This guide currently features Ethercluster deployment on Google Cloud Platform."><meta data-react-helmet="true" property="og:description" content="This guide will help you build your own Ethereum Classic API service using Ethercluster. This guide currently features Ethercluster deployment on Google Cloud Platform."><meta data-react-helmet="true" property="og:url" content="https://etccooperative.github.io/ethercluster-site/ethercluster-website/docs/doc3"><link data-react-helmet="true" rel="shortcut icon" href="/ethercluster-website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://etccooperative.github.io/ethercluster-site/ethercluster-website/docs/doc3"><link rel="stylesheet" href="/ethercluster-website/styles.d6ee8ce8.css">
<link rel="preload" href="/ethercluster-website/styles.c6200a68.js" as="script">
<link rel="preload" href="/ethercluster-website/runtime~main.e4d54834.js" as="script">
<link rel="preload" href="/ethercluster-website/main.5fc584bb.js" as="script">
<link rel="preload" href="/ethercluster-website/common.88216938.js" as="script">
<link rel="preload" href="/ethercluster-website/22.ee027d92.js" as="script">
<link rel="preload" href="/ethercluster-website/23.54201a53.js" as="script">
<link rel="preload" href="/ethercluster-website/f976f453.f693fd34.js" as="script">
<link rel="preload" href="/ethercluster-website/17896441.2f1515b2.js" as="script">
<link rel="preload" href="/ethercluster-website/225b4c69.e885ddc8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/ethercluster-website/"><img class="navbar__logo" src="/ethercluster-website/img/logo.a1078a11.png" alt="My Site Logo"><strong class="navbar__title">Ethercluster</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ethercluster-website/docs/doc1">Docs</a><a class="navbar__item navbar__link" href="/ethercluster-website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/etccooperative/ethercluster" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/ethercluster-website/"><img class="navbar__logo" src="/ethercluster-website/img/logo.a1078a11.png" alt="My Site Logo"><strong class="navbar__title">Ethercluster</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/ethercluster-website/docs/doc1">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/ethercluster-website/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/etccooperative/ethercluster" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ethercluster-website/docs/doc1">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ethercluster-website/docs/doc2">Core Concepts</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/ethercluster-website/docs/doc3">Build your first Ethercluster</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ethercluster-website/docs/">API Access</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Build your first Ethercluster</h1></header><div class="markdown"><p>This guide will help you build your own Ethereum Classic API service using Ethercluster. This guide currently features Ethercluster deployment on Google Cloud Platform.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-01---setup-google-cloud"></a>Step 01 - Setup Google Cloud<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-01---setup-google-cloud" title="Direct link to heading">#</a></h2><ul><li>Signup for a <a href="https://cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud</a> account and <a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener noreferrer">create a new project</a>. You can conveniently name your project, <code>ethercluster</code>.</li></ul><p><img src="https://user-images.githubusercontent.com/10556209/96285459-9c85ce00-0fa4-11eb-9407-277b6ee700ca.png"></p><ul><li><p>Setup <a href="https://cloud.google.com/billing/docs/how-to/modify-project" target="_blank" rel="noopener noreferrer">billing</a> if you&#x27;re going to pursue making your Ethercluster. </p></li><li><p>Enable <strong>Compute Engine API</strong>, <strong>Cloud Shell API</strong>, and <strong>Kubernetes Engine API</strong> which can be found in the <a href="https://console.cloud.google.com/apis?_ga=2.172155431.56694028.1602866660-1600774775.1602866660" target="_blank" rel="noopener noreferrer">Marketplace</a>. For example: </p></li></ul><p><img src="https://user-images.githubusercontent.com/10556209/96285814-0e5e1780-0fa5-11eb-95ff-a3a3d571bf0a.png"></p><ul><li><a href="https://cloud.google.com/docs/authentication/getting-started" target="_blank" rel="noopener noreferrer">Setup Credentials</a> which will generate a JSON file for you to download. This will be used to easily authenticate into Google Cloud from your local terminal.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-02---install-terraform"></a>Step 02 - Install Terraform<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-02---install-terraform" title="Direct link to heading">#</a></h2><p><a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform</a> is infra-as-code to allow you to provision your cloud infrastructure in a way that&#x27;s clear and easy to roll-back and version control.</p><p>This allows any changes you make to your cloud architecture to be reflected in code and saved, so that any new changes you add can be tracked and debugged.</p><ul><li><a href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener noreferrer">Download, unpack, and install Terraform</a> via release binary for your operating system <a href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener noreferrer">https://www.terraform.io/downloads.html</a>.</li></ul><p>Downloading binary on Linux:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> https://releases.hashicorp.com/terraform/0.13.4/terraform_0.13.4_linux_amd64.zip</span></div></div></div></div></div><p>Unpack files:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">unzip</span><span class="token plain"> terraform_0.13.4_linux_amd64.zip</span></div></div></div></div></div><p>At this point the executable <code>terraform</code> binary can be run. However, you may want to move it in a more appropriate location and add to your PATH.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mv</span><span class="token plain"> terraform /bin/</span></div></div></div></div></div><p>or move anywhere else and export to PATH</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mv</span><span class="token plain"> terraform /</span><span class="token environment constant" style="color:rgb(130, 170, 255)">$HOME</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(130, 170, 255)">PATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string environment constant" style="color:rgb(130, 170, 255)">$PATH</span><span class="token string" style="color:rgb(195, 232, 141)">:/</span><span class="token string environment constant" style="color:rgb(130, 170, 255)">$HOME</span><span class="token string" style="color:rgb(195, 232, 141)">/terraform&quot;</span></div></div></div></div></div><p>Run terraform from a terminal</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-03---create-a-terraform-configuration-for-gke"></a>Step 03 - Create a Terraform configuration for GKE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-03---create-a-terraform-configuration-for-gke" title="Direct link to heading">#</a></h2><p>Create directory for your Terraform project and change directory into it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> Ethercloud </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> Ethercloud</span></div></div></div></div></div><p>Initialize a new Terraform project:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform init</span></div></div></div></div></div><p>Terraform will return the following since there&#x27;s no existing Terraform config files.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform initialized in an empty directory!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The directory has no Terraform configuration files. You may begin working</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">with Terraform immediately by creating Terraform configuration files.</span></div></div></div></div></div><p>Now, create a new Terraform configuration file:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">touch</span><span class="token plain"> ethercloud.tf</span></div></div></div></div></div><p>Using your preferred editor, we&#x27;ll have to specify our Ethercluster infrastructure in <code>ethercloud.tf</code> like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;google&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    project = &quot;ethercluster&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    region = &quot;us-central1&quot;       </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    zone = &quot;us-central1-c&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_container_cluster&quot; &quot;primary&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;ether-cluster&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    remove_default_node_pool = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initial_node_count = 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    master_auth {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        username = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        password = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_container_node_pool&quot; &quot;primary_preemptible_nodes&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;my-node-pool&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cluster = &quot;${google_container_cluster.primary.name}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node_count = 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node_config {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        preemptible = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        machine_type = &quot;n1-standard-1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        metadata = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            disable-legacy-endpoints = &quot;true&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        oauth_scopes = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;https://www.googleapis.com/auth/logging.write&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;https://www.googleapis.com/auth/monitoring&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;client_certificate&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.client_certificate}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;client_key&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.client_key}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;cluster_ca_certificate&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.cluster_ca_certificate}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_compute_address&quot; &quot;ip_address&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;ethercluster-address&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="understanding-our-terraform-configuration-file"></a>Understanding our Terraform configuration file<a aria-hidden="true" tabindex="-1" class="hash-link" href="#understanding-our-terraform-configuration-file" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="provider"></a>Provider<a aria-hidden="true" tabindex="-1" class="hash-link" href="#provider" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-tf codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;google&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    project = &quot;ethercloud&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    region = &quot;us-central1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    zone = &quot;us-central1-c&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>What we did here was specify provider as <code>google</code>, gave it a project name <code>ethercloud</code>, and then added the region <code>us-central-1</code> and the zone <code>us-central1-c</code>. You don&#x27;t have to use the same names and regions, but this will be what I use for the purpose of this guide.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="gke"></a>GKE<a aria-hidden="true" tabindex="-1" class="hash-link" href="#gke" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_container_cluster&quot; &quot;primary&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;ethercluster&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    remove_default_node_pool = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    initial_node_count = 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    master_auth {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        username = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        password = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>This specifies that we want a GKE cluster we will call <code>primary</code>. We also specify the cluster name as <code>ethercluster</code> We add an initial node count of <code>1</code>, but we can&#x27;t specify our own Kubernetes node pool first, so we use the initial node count and then we delete it. We have our <code>master_auth</code> set to empty because we don&#x27;t want to use any custom auth.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_container_node_pool&quot; &quot;primary_preemptible_nodes&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;my-node-pool&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cluster = &quot;${google_container_cluster.primary.name}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node_count = 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node_config {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        preemptible = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        machine_type = &quot;n1-standard-1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        metadata = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            disable-legacy-endpoints = &quot;true&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        oauth_scopes = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;https://www.googleapis.com/auth/logging.write&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;https://www.googleapis.com/auth/monitoring&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Here we are basically specifying the node pool with 3 nodes. Three nodes means three Google Compute Engine instances where we will be hosting out Kubernetes cluster. We also specify the type of instance to be <code>n1-standard-1</code>.</p><p>For more information on this setup, checkout the guide from Terraform <a href="https://www.terraform.io/docs/providers/google/r/container_cluster.html" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Moving forward, we want to add the Cluster certificate and a static IP address in case you chose to expose your RPC endpoint publicly over SSL. It&#x27;ll be easier to assign it to a static IP address you created on GKE so it doesn&#x27;t change addresses every time you modify it.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;client_certificate&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.client_certificate}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;client_key&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.client_key}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;cluster_ca_certificate&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value = &quot;${google_container_cluster.primary.master_auth.0.cluster_ca_certificate}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;google_compute_address&quot; &quot;ip_address&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;ethercluster-address&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Here, we basically specify the client key and certificate, as well as cluster certificate and ip_address. We will call this address <code>ethercluster-address</code>.</p><p>Great, we finally have the entire code we need to get started. Let&#x27;s start terraforming!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-04---terraform-plan-and-apply-infrastructure"></a>Step 04 - Terraform <code>Plan</code> and <code>Apply</code> infrastructure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-04---terraform-plan-and-apply-infrastructure" title="Direct link to heading">#</a></h2><p>Now that your infrastructure is defined in your terraform configuration file, it&#x27;s time to <code>terraform plan</code> &amp; <code>terraform apply</code>.</p><p>Terraform plan allows you to see what changes Terraform will do to your file without making the changes. It also is helpful for catching bugs.</p><p>Run <code>terraform plan</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform plan</span></div></div></div></div></div><p>Terraform will analyse your code and return an output like the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Refreshing Terraform state in-memory prior to plan...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The refreshed state will be used to calculate this plan, but will not be</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">persisted to local or remote state storage.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------------------------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">An execution plan has been generated and is shown below.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Resource actions are indicated with the following symbols:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform will perform the following actions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # google_compute_address.ip_address will be created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + resource &quot;google_compute_address&quot; &quot;ip_address&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + address_type       = &quot;EXTERNAL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + name               = &quot;ethercluster-address&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # google_container_cluster.primary will be created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + resource &quot;google_container_cluster&quot; &quot;primary&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + name                        = &quot;ether-cluster&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + network                     = &quot;default&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # google_container_node_pool.primary_preemptible_nodes will be created</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + resource &quot;google_container_node_pool&quot; &quot;primary_preemptible_nodes&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + cluster             = &quot;ether-cluster&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + id                  = (known after apply)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + management {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          * </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      + node_config {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Plan: 3 to add, 0 to change, 0 to destroy.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------------------------------------------------------</span></div></div></div></div></div><p>Note, this isn&#x27;t the exact output, it&#x27;ll have a lot more data in it with keys, but the values will say <code>(known after apply)</code>. This tells us that Terraform won&#x27;t have the exact values for the configuration of our cloud for most of the keys until after we actually create our architecture on Google Cloud.</p><p>To apply the configuration on Google Cloud, simply run <code>terraform apply</code>.</p><p>Run Terraform apply:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform apply</span></div></div></div></div></div><p>Now, since you already have your project json file from Google Cloud for authing added to your PATH in previous sections, Terraform can use it to deploy your cloud architecture for you. It&#x27;ll go through the same output you saw in plan but with an execution plan and then start creating your instances. It&#x27;ll take a little time to create, so go have a coffee break while you wait.</p><p>The output will look something like the following.</p><p><img src="https://user-images.githubusercontent.com/10556209/96288555-36e81080-0fa9-11eb-8afb-0ff68611cd23.gif" alt="terraform-apply"></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">An execution plan has been generated and is shown below.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Resource actions are indicated with the following symbols:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  + create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform will perform the following actions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Apply complete! Resources: 3 added, 0 changed, 0 destroyed.</span></div></div></div></div></div><p>Terraform has just created your infrastructure architecture on Google Cloud. Now it&#x27;s time to SSH into Google Cloud Shell.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-05---final-cluster-setup"></a>Step 05 - Final cluster setup<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-05---final-cluster-setup" title="Direct link to heading">#</a></h2><p>Now, at this point we have our Ethercluster node infrastructure deployed which is a fully functioning kubernetes cluster on Google Cloud. Running a node requires storage, the protocol providing client, and our desired networking for access the API.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="namespace"></a>Namespace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#namespace" title="Direct link to heading">#</a></h3><p>Namespaces in Kubernetes allow us to assign a name for specific projects we are working on inside Kubernetes. It&#x27;s useful if you want to organize your cluster between <code>dev</code> and <code>prod</code> namespaces for example.</p><p>Here, we will just be using it for <code>ethercluster</code> to make it easier to see everything.</p><p>To create a namespace, I&#x27;ll be writing up a YAMl config file for Kubernetes.</p><p>Each Kubernetes manifest file has three things:</p><p>apiVersion (to specify which API to use)
kind (to determine what Kubernetes component the file is)
metadata (extra information about the manifest)</p><p>We also have a <code>spec</code> section to specify how we want the manifest behaves, which we will see when we build our cluster.</p><p>Picking up from where we left off in Google Cloud Shell page, let&#x27;s see if <code>kubectl</code> is running. <code>kubectl</code> is a command line application that uses the Kubernetes API to interact with your cluster.</p><p>Connect to cluster from inside Google Cloud Shell:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud container clusters get-credentials ethercloud --zone us-central1-c --project ethercloud</span></div></div></div></div></div><p>Check if <code>kubectl</code> is working:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl</span></div></div></div></div></div><p>The output would be similar to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">The output should look something like this:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl controls the Kubernetes cluster manager.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kubectl [flags] [options]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use &quot;kubectl &lt;command&gt; --help&quot; for more information about a given command.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use &quot;kubectl options&quot; for a list of global command-line options (applies to all commands).</span></div></div></div></div></div><p>Now, let&#x27;s define namespace in the Namespace manifect file. You can use <code>vim</code> or your preferred editor:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> ethercluster-namespace.yml</span></div></div></div></div></div><p>Add the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Namespace</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster </span></div></div></div></div></div><p>This specifies that our manifest is <code>kind</code> of <code>Namespace</code>, with a name of <code>ethercluster</code>.</p><p>Now that there is a manifest for Namespace, it has to be applied like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f ethercluster-namespace.yml</span></div></div></div></div></div><p>Output:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace/ethercluster created</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="volume"></a>Volume<a aria-hidden="true" tabindex="-1" class="hash-link" href="#volume" title="Direct link to heading">#</a></h3><p>We will need to specify a <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener noreferrer">StorageClass</a> for our Deployment volume. Here, we will use SSD since it&#x27;s best for syncing clients.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> classic-storage-class.yml</span></div></div></div></div></div><p>Add the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> StorageClass</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> storage.k8s.io/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ssd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">provisioner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> kubernetes.io/gce</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ssd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">zones</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">reclaimPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Retain</span></div></div></div></div></div><p>Notice how we specified the provisioner to be <code>gce-pd</code>. It&#x27;s to specify the Cloud Provider type of disk we want. We then specify it to be a persistent disk SSD <code>pd-ssd</code> and the zone is <code>us-central1-c</code> which is the same one we specified in Terraform, which is where our GKE cluster was created.</p><p>Let&#x27;s create the StorageClass via:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f classic-storage-class.yml</span></div></div></div></div></div><p>This will create the StorageClass in Google Cloud which we will use when doing a Deployment later.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="service"></a>Service<a aria-hidden="true" tabindex="-1" class="hash-link" href="#service" title="Direct link to heading">#</a></h3><p>In Service, we will need to specify the ports we are interested in obtaining from our node. For the purpose of a public RPC endpoint, we will need port 8545 which is the default RPC port. If you need something more custom, like WebSockets, then port 8546 is the one you want. Here, we will only go over 8545. We add 8080 for default and 443 for SSL.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> classic-service.yml</span></div></div></div></div></div><p>Add the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cloud.google.com/app-protocols</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;my-https-port&quot;:&quot;HTTPS&quot;,&quot;my-http-port&quot;:&quot;HTTP&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TCP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rpc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">endpoint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8545</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TCP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8545</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TCP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> LoadBalancer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sessionAffinity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ClientIP</span></div></div></div></div></div><p>If you notice, we specify the <code>kind</code> to be Service here. We call the service <code>classic</code> which will allow it to auto-discover the deployment after with the same name.</p><p>Notice how we have <code>port</code> and <code>targetPort</code> specified. It tells the Service we want to this Service&#x27;s port 8545 to route to the container&#x27;s port 8545.</p><p>We specify the type to be <code>LoadBalancer</code> to expose it and allow for selecting between the different nodes we will create with Parity. We also add a sessionAffinity so that if you connect to a node assigned by the load balancer, the next time you connect to it, load balancer will reconnect you to the same node.</p><p>Create the service:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f classic-service.yml</span></div></div></div></div></div><p>Now, get all components of your cluster:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get all -n ethercluster</span></div></div></div></div></div><p>Example output:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/classic             LoadBalancer   10.00.00.00   &lt;pending&gt;      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m</span></div></div></div></div></div><p>The external-ip is <code>&lt;pending&gt;</code> because Kubernetes is creating an endpoint to expose which may take a few minutes. While this is running we can move onto deploying our blockchain API service.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deployment"></a>Deployment<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deployment" title="Direct link to heading">#</a></h3><p>For the rest of this exercise we&#x27;ll be going over the code found in this <a href="https://github.com/ethereum-classic-cooperative/ethercluster" target="_blank" rel="noopener noreferrer">repository</a> which contains example manifest files. Before running our deployment and running a node we need to figure out what arguments we need for our Docker container image.</p><p>We will use <a href="https://hub.docker.com/r/hyperledger/besu/tags" target="_blank" rel="noopener noreferrer">Hypereledger Besu</a> has our protocol providing client. Hyperledger Besu is an enterprise Ethereum client that can be used for Ethereum, Ethereum Classic, and related test networks.</p><p>If you&#x27;re familiar with Docker, running a Besu docker container could be done with the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -p </span><span class="token number" style="color:rgb(247, 140, 108)">8545</span><span class="token plain">:8545 -p </span><span class="token number" style="color:rgb(247, 140, 108)">13001</span><span class="token plain">:30303 hyperledger/besu:latest --rpc-http-enabled --network</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CLASSIC</span></div></div></div></div></div><p>If you go to <code>deployments/classic/classic-besu-stateful-set.yml</code>, you&#x27;ll see that the file has the <code>kind</code> value of <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">StatefulSet</a>. This is important since it specifies we want a stateful application that guarantees ordering and uniqueness across any rescheduling. Imagine we didn&#x27;t use a statefulset here. If we deploy our container to Kubernetes, Besu begins syncing the chain from the beginning. Kubernetes can then choose to restart Pods at intervals to ensure updates. What happens in this situation is that the restart will also cause Besu to resync from the beginning, which isn&#x27;t what we desire. It&#x27;s why StatefulSet is the desired Deployment here.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1beta1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: StatefulSet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: ethercluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app: classic</span></div></div></div></div></div><p>This is the beginning of our StatefulSet deployment file. It specifies the correct namespace for Ethercluster, names our Deployment <code>classic</code> in order to be able to identify what network it is, and points the <code>kind</code> to StatefulSet.</p><p>This isn&#x27;t the only contents of the file, we will go on and define the <code>specs</code>.</p><p>In the specs, you&#x27;ll notice we have the <code>replicas</code> to be 3. This means we will be running 3 Parity nodes, which we will LoadBalance. In containers section, we specify the image <code>besu</code> from Besu&#x27;s Dockerhub endpoint.</p><p>We pass in the values to that containers such as <code>chain=classic</code>. This specifies that we want the Ethereum Classic chain to be our default network to run. This is how Kubernetes can specify the arguments for the container like Docker does in the previous example.</p><p>We also specify we want the ports 8545 since we want to expose the RPC. We have some readinessProbe and livenessProbe in order to do health checks on the Probe. It happens by doing an HTTP GET request on port 8545 of the container on the endpoint <code>/api/health</code>, which checks if the Parity node is fully synced or not. If it&#x27;s not synced up yet, it returns a 503, otherwise it will return a 200, thus passing the health check.</p><p>We also specify a <code>volumeClaimTemplates</code> for this Deployment of 50 GB, which is what will be needed to run a full ETC node. If you want to instead run an ETH node, you&#x27;ll need to adjust the value appropriately (300 GB to stay on the safe side).</p><p>Now, we will instantiate the deployment:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f deployments/classic/classic-besu-stateful-set.yml</span></div></div></div></div></div><p>See the deployment in action:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get all -n ethercluster</span></div></div></div></div></div><p>Example output:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                     READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-0                            2/2     Running   0          1m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-1                            2/2     Running   0          1m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-2                            2/2     Running   0          1m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/classic             LoadBalancer   10.00.00.00     109.01.01.01      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                       READY   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">statefulset.apps/classic   3/3     1m</span></div></div></div></div></div><p>Note that the age shown above might not be exact to what you get since it&#x27;s still creating each Pod 1 by 1. Why do we have three pods? It&#x27;s because we specified our replica to be 3 in our deployment file.</p><p>Each pod is created by the Statefulset, where it&#x27;s mounted to a volume from <code>classic-ssd</code> that we instantiated before, and then each image of the containers are pulled and instantiated, and begin running, before the next pod is created.</p><p>Inspect a pod individually:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl describe pod classic-0 -n ethercluster</span></div></div></div></div></div><p>View logs:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl logs classic-0 besu -n ethercluster</span></div></div></div></div></div><p>Woohoo! Now you have a fully functioning Ethereum Classic node with built on a kubernetes cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="confirm-node-is-running"></a>Confirm node is running<a aria-hidden="true" tabindex="-1" class="hash-link" href="#confirm-node-is-running" title="Direct link to heading">#</a></h3><p>Use <a href="https://curl.haxx.se/" target="_blank" rel="noopener noreferrer">cURL</a> to call <a href="https://besu.hyperledger.org/en/stable/Reference/API-Methods/" target="_blank" rel="noopener noreferrer">JSON-RPC API methods</a>to confirm the node is running.</p><p><em>replace <code>IP</code> with your <code>External IP</code>  from <code>kubectl get services classic -n ethercluster</code></em></p><p><code>eth_chainId</code> returns the chain ID of the network:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -X POST --data &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;jsonrpc&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eth_chainId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;params&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&#x27; localhost</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8545</span></div></div></div></div></div><p><code>eth_syncing</code> returns the starting, current, and highest block.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl -X POST --data &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;jsonrpc&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eth_syncing&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;params&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">&#x27; localhost</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">8545</span></div></div></div></div></div><p>After connecting to mainnet <code>eth_syncing</code> will return something similar to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;jsonrpc&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2.0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;result&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;startingBlock&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;currentBlock&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x2d0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;highestBlock&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x66c0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scaling-pods"></a>Scaling Pods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scaling-pods" title="Direct link to heading">#</a></h2><p>Depending on your network traffic you may need to scale you may need to scale your cluster up or down in Kubernetes with one command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubernetes scale statefulset classic -n ethercluster --replicas</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span></div></div></div></div></div><p>This will increase replicas to 4 or decrease replicas to however many you desire.</p><p>See it being created:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubernetes get all -n ethercluster</span></div></div></div></div></div><p>Example output:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                     READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-0                            2/2     Running   0          10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-1                            2/2     Running   0          10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-2                            2/2     Running   0          10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pod/classic-3                            2/2     Running   0          1m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/classic             LoadBalancer   10.00.00.00     109.01.01.01      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                       READY   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">statefulset.apps/classic   3/3     10m</span></div></div></div></div></div><p>Notice you now have a <code>classic-3</code> pod being created and beginning to sync. You can do the same thing to scale it back to 3 by changing the previous command from 4 replicas to 3. Also, GKE does offer auto-scaling for you if needed, but that&#x27;ll affect your billing if you don&#x27;t monitor it consistently.</p><p>In the next section, we will go over securing your endpoint with SSL when using it publicly. It&#x27;s not really needed if you want to use RPC only internally within your own infrastructure.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ssl-configuration"></a>SSL Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ssl-configuration" title="Direct link to heading">#</a></h2><p>To setup SSL configuration you need:</p><ul><li>a domain name</li><li>SSL certificate for the domain name</li></ul><p><code>Ethercluster.com</code> uses Namecheap and Namecheap has a guide on registering an SSL for you which will provide an:</p><ul><li>SSL Key <code>.key</code></li><li>SSL Certificate <code>.crt</code></li></ul><p><strong>NOTE</strong> Setting up SSL for your Ethercluster is optional, but useful to expose your RPC publicly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="secrets"></a>Secrets<a aria-hidden="true" tabindex="-1" class="hash-link" href="#secrets" title="Direct link to heading">#</a></h3><p>Now that we have our <code>domain-com.key</code> and <code>domain-com.crt</code>, we can create a Kubernetes secret for them so we can securely store it.</p><p>If we have both files in a directory called <code>config</code>, then we can run the following command to instantiate them:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl tls tls-classic --key ./config/domain-com.key --cert ./config/domain-com.crt --namespace ethercluster </span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ingress"></a>Ingress<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ingress" title="Direct link to heading">#</a></h3><p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreferrer">Ingress</a> allows us to route to different services to the outside via HTTP and HTTPS, as well as allow us to terminate TCP/SSL.</p><p>We will need to create the ingress manifest file then instantiate it. After that, we need to configure the Health Checks in Google Cloud.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> ingress.yml</span></div></div></div></div></div><p>And input the following contents in ingress.yml:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-yml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> extensions/v1beta1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Ingress</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ingress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ethercluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">kubernetes.io/ingress.global-static-ip-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ethercluster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">kubernetes.io/ingress.allow-http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gce&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> www.domain.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8545</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> www.domain.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> classic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8545</span></div></div></div></div></div><p>This specifies that we&#x27;re creating an ingress that points to <code>ethercluster-address</code> (the static IP created in Terraform). It also assigns the host to the domains.com we added and provides </p><p>It also assigns the host to the domain.com we added and provides the secretName as <code>tls-classic</code> as we created before. It wires to the backend to the serviceName <code>classic</code> at port 8545.</p><p>Instantiate the ingress:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f ingress.yml</span></div></div></div></div></div><p>Monitor progression:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl describe ingress ingress-ethercluster -n ethercluster</span></div></div></div></div></div><p>While you monitor it, you need to head over to Google Cloud to set up the Health Checks. Reason is, it won&#x27;t be exposed publicly if the health checks aren&#x27;t passed on Google Cloud, and they&#x27;re not yet sure how to check the health status of Parity.</p><p>We do that by going over to Google Cloud, and then to Kubernetes Engine section on the left, and then click on Services as shown below:</p><p><img src="https://user-images.githubusercontent.com/10556209/97757447-b954f200-1aca-11eb-9a22-393b4ab3dd71.png"></p><p>We click on the Ingress we created earlier here, and then try to determine the port number for your classic service. It&#x27;s the port number assigned by Kubernetes. You can find it by running the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> classic -n ethercluster</span></div></div></div></div></div><p>It&#x27;ll return what we saw earlier:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                                       AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/classic             LoadBalancer   10.00.00.00   &lt;pending&gt;      8080:30003/TCP,8545:30002/TCP,443:30001/TCP   1m</span></div></div></div></div></div><p>If you notice under <code>PORT(S)</code>, you&#x27;ll see the port <code>8545:30002</code>. The 30002 is the one assigned by Kubernetes for the abstracted 8545. That&#x27;s the port you&#x27;ll need to look for under the Ingress section, as shown below: list-ingress</p><p>Click on the appropriate one, which will lead you to its page.</p><p>Scroll down until you find the health check section. It has a link under it that you must click as well.</p><p>Now, you&#x27;re taken to the Health Check page.</p><p>It checks Parity&#x27;s 8545 port at actual port 30002. But it does the health check on this endpoint <code>/</code> Parity health checks happen at <code>/api/health</code>.</p><p>Configure it accordingly as shown below, then save it.</p><p><img src="https://user-images.githubusercontent.com/10556209/97757625-1e104c80-1acb-11eb-9af3-926dd9554312.png"></p><p>Now, wait about 10-15 minutes for the health checks to pass. You should be able to now use your RPC endpoint over SSL.</p><p>If you have any issues, you can always use <code>kubectl describe</code> to debug your ingress.</p><p>I hope you enjoyed this guide and the cool tools given to us by the Cloud, Kubernetes and Terraform.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/doc3.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ethercluster-website/docs/doc2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Core Concepts</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ethercluster-website/docs/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">API Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-01---setup-google-cloud" class="table-of-contents__link">Step 01 - Setup Google Cloud</a></li><li><a href="#step-02---install-terraform" class="table-of-contents__link">Step 02 - Install Terraform</a></li><li><a href="#step-03---create-a-terraform-configuration-for-gke" class="table-of-contents__link">Step 03 - Create a Terraform configuration for GKE</a></li><li><a href="#understanding-our-terraform-configuration-file" class="table-of-contents__link">Understanding our Terraform configuration file</a><ul><li><a href="#gke" class="table-of-contents__link">GKE</a></li></ul></li><li><a href="#step-04---terraform-plan-and-apply-infrastructure" class="table-of-contents__link">Step 04 - Terraform <code>Plan</code> and <code>Apply</code> infrastructure</a></li><li><a href="#step-05---final-cluster-setup" class="table-of-contents__link">Step 05 - Final cluster setup</a><ul><li><a href="#namespace" class="table-of-contents__link">Namespace</a></li><li><a href="#volume" class="table-of-contents__link">Volume</a></li><li><a href="#service" class="table-of-contents__link">Service</a></li><li><a href="#deployment" class="table-of-contents__link">Deployment</a></li><li><a href="#confirm-node-is-running" class="table-of-contents__link">Confirm node is running</a></li></ul></li><li><a href="#scaling-pods" class="table-of-contents__link">Scaling Pods</a></li><li><a href="#ssl-configuration" class="table-of-contents__link">SSL Configuration</a><ul><li><a href="#secrets" class="table-of-contents__link">Secrets</a></li><li><a href="#ingress" class="table-of-contents__link">Ingress</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ethercluster-website/docs/doc1">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/ethercluster-website/docs/doc2/">Core Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/ethercluster-website/docs/doc3/">Build an Ethercluster</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/hQs894U" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ethercluster-website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ETCCooperative/ethercluster-website" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ETC Cooperative. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ethercluster-website/styles.c6200a68.js"></script>
<script src="/ethercluster-website/runtime~main.e4d54834.js"></script>
<script src="/ethercluster-website/main.5fc584bb.js"></script>
<script src="/ethercluster-website/common.88216938.js"></script>
<script src="/ethercluster-website/22.ee027d92.js"></script>
<script src="/ethercluster-website/23.54201a53.js"></script>
<script src="/ethercluster-website/f976f453.f693fd34.js"></script>
<script src="/ethercluster-website/17896441.2f1515b2.js"></script>
<script src="/ethercluster-website/225b4c69.e885ddc8.js"></script>
</body>
</html>